<UserControl x:Class="SN.withSIX.Play.Presentation.Wpf.Views.Controls.ContactListControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:cal="http://www.caliburnproject.org"
             xmlns:componentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
             xmlns:connect="clr-namespace:SN.withSIX.Play.Core.Connect;assembly=SN.withSIX.Play.Core"
             xmlns:dragDrop="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop"
             xmlns:core="clr-namespace:SN.withSIX.Core.Applications;assembly=SN.withSIX.Core.Applications"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:viewModels11="clr-namespace:SN.withSIX.Play.Applications.ViewModels.Connect;assembly=SN.withSIX.Play.Applications"
             xmlns:controls="clr-namespace:SN.withSIX.Core.Presentation.Wpf.Views.Controls;assembly=SN.withSIX.Core.Presentation.Wpf"
             xmlns:controls1="clr-namespace:SN.withSIX.Play.Presentation.Wpf.Views.Controls"
             xmlns:extensions="clr-namespace:SN.withSIX.Core.Presentation.Wpf.Extensions;assembly=SN.withSIX.Core.Presentation.Wpf"
             mc:Ignorable="d" d:DataContext="{d:DesignInstance viewModels11:ConnectViewModel}"
             d:DesignHeight="600" d:DesignWidth="200">

    <UserControl.Resources>
        <CollectionViewSource x:Key="Contacts" Source="{Binding Contacts}"
                              IsLiveFilteringRequested="True"
                              IsLiveSortingRequested="True"
                              Filter="Contacts_OnFilter">
            <CollectionViewSource.SortDescriptions>
                <componentModel:SortDescription PropertyName="SortKey" Direction="Ascending" />
                <componentModel:SortDescription PropertyName="Model.DisplayName" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
            <CollectionViewSource.LiveFilteringProperties>
                <system:String>Model.IsHidden</system:String>
            </CollectionViewSource.LiveFilteringProperties>
        </CollectionViewSource>

        <ContextMenu x:Key="UserContactMenu"
                     DataContext="{Binding PlacementTarget.Tag.UserContactContextMenu, RelativeSource={RelativeSource Self}}" />
        <CollectionViewSource x:Key="AddFriendViewSource"
                              Source="{Binding ContactList.AddFriends}">
            <CollectionViewSource.SortDescriptions>
                <componentModel:SortDescription PropertyName="IntState" Direction="Descending" />
                <componentModel:SortDescription PropertyName="DisplayName" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>

        <DataTemplate x:Key="AddFriendTemplate" DataType="{x:Type connect:AddFriend}">
            <Grid Background="Transparent">
                <!--  ContextMenu="{StaticResource UserMenu}"-->
                <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40" />
                    <ColumnDefinition Width="140*" />
                    <ColumnDefinition Width="28" />
                </Grid.ColumnDefinitions>

                <controls:CachedImageWithAnimatedGifSupport ImageUrl="{Binding Account.Avatar}"
                                                            DefaultImageSource="pack://application:,,,/SN.withSIX.Core.Presentation.Resources;component/images/ProfilePlaceholder-small40x40.png"
                                                            Grid.Column="0" Grid.Row="0" MaxHeight="32"
                                                            MaxWidth="32" />

                <DockPanel Grid.Row="0" Grid.Column="1" Margin="4 0 0 0" HorizontalAlignment="Left"
                           VerticalAlignment="Center">
                    <TextBlock Text="{Binding Account.DisplayName}" FontSize="14" DockPanel.Dock="Top" />

                    <StackPanel DockPanel.Dock="Top"
                                Visibility="{Binding IsContact, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}">
                        <TextBlock Text="Request Pending..." FontSize="10"
                                   Visibility="{Binding IsMutualFriend, Converter={StaticResource BooleanToVisibilityCollapsedConverter},ConverterParameter=True, FallbackValue=Collapsed}" />
                    </StackPanel>
                    <StackPanel DockPanel.Dock="Top"
                                Visibility="{Binding IsContact, Converter={StaticResource BooleanToVisibilityCollapsedConverter},ConverterParameter=True}">
                        <TextBlock Text="Not in list yet" FontSize="10" />
                    </StackPanel>
                </DockPanel>

                <Button FontSize="14"
                        Visibility="{Binding IsContact, Converter={StaticResource BooleanToVisibilityCollapsedConverter},ConverterParameter=True}"
                        Grid.Column="2" HorizontalAlignment="Left" VerticalAlignment="Center"
                        ToolTip="Add friend"
                        Command="{Binding DataContext.AddFriendCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBox}}}"
                        CommandParameter="{Binding}">
                    <Button.Template>
                        <ControlTemplate>
                            <Grid Background="Transparent">
                                <Viewbox MaxWidth="16" MaxHeight="16">
                                    <Canvas Width="16.000" Height="13.857">
                                        <!-- Ebene 1/<Compound Path> -->
                                        <Path Fill="{StaticResource SixGreen}"
                                              Data="F1 M 8.959,7.890 L 8.936,11.017 L 7.002,11.003 L 7.025,7.905 L 3.928,7.929 L 3.912,5.993 L 7.040,5.970 L 7.064,2.841 L 8.999,2.858 L 8.974,5.956 L 12.073,5.933 L 12.088,7.866 L 8.959,7.890 Z M 14.668,4.619 L 13.336,2.309 L 12.000,0.000 L 4.000,0.000 L 2.664,2.309 L 1.336,4.619 L 0.000,6.930 L 1.336,9.236 L 2.664,11.547 L 4.004,13.857 L 6.668,13.857 L 9.332,13.857 L 12.004,13.857 L 13.336,11.547 L 14.668,9.236 L 16.000,6.930 L 14.668,4.619 Z" />
                                    </Canvas>
                                </Viewbox>
                            </Grid>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </DataTemplate>

        <Style TargetType="{x:Type ListBoxItem}" BasedOn="{StaticResource {x:Type ListBoxItem}}">
            <Setter Property="BorderThickness" Value="0 0 0 2" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding Model, Converter={StaticResource ObjectToTypeConverter}}"
                             Value="{x:Type connect:InviteRequest}">
                    <Setter Property="Background" Value="{StaticResource SixSoftGray}" />
                </DataTrigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentColorBrush}" />
                    <!-- <Setter Property="Background" Value="White" /> -->
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="24" />
            <RowDefinition Height="8" />
            <RowDefinition Height="28" />
            <RowDefinition Height="8" />
            <RowDefinition Height="472*" />
        </Grid.RowDefinitions>

        <Grid>
            <DockPanel Margin="4 0 0 0">
                <DockPanel.Resources>
                    <Style TargetType="TextBlock">
                        <Setter Property="FontSize" Value="10" />
                    </Style>
                </DockPanel.Resources>
                <DockPanel Background="{DynamicResource WhiteBrush}" Width="194" Margin="-1,0,0,0"
                           cal:Bind.ModelWithoutContext="{Binding ContactFilter}">
                    <TextBlock VerticalAlignment="Center"
                               Margin="8,0,0,0">
                        <TextBlock.ToolTip>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0} friends">
                                        <Binding Path="ContactList.UserInfo.Friends.Count" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </TextBlock.ToolTip>
                        <Hyperlink Command="{Binding SwitchShowAll}"
                                   Background="Transparent" TextDecorations="None">
                            <Hyperlink.Style>
                                <Style TargetType="Hyperlink">
                                    <Setter Property="Foreground" Value="{DynamicResource AccentColorBrush}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ContactFilter.ShowOnlyOnline}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource SixLightGray}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ContactFilter.ShowOnlyIngame}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource SixLightGray}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Hyperlink.Style>
                            FRIENDS
                        </Hyperlink>
                    </TextBlock>
                    <TextBlock VerticalAlignment="Center" HorizontalAlignment="Right" DockPanel.Dock="Right"
                               Foreground="{StaticResource SixLightGray}"
                               Margin="0,0,8,0">
                        <TextBlock Text="{Binding ContactList.Gaming.Count, FallbackValue=0}"
                                   Foreground="{DynamicResource AccentColorBrush}" Margin="4,0,4,0">
                            <TextBlock.ToolTip>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0}/{1} in-game friends">
                                            <Binding Path="ContactList.Gaming.Count" />
                                            <Binding Path="ContactList.UserInfo.Friends.Count" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </TextBlock.ToolTip>
                        </TextBlock>
                        <Hyperlink TextDecorations="None"
                                   Command="{Binding SwitchShowOnlyIngame}">
                            <Hyperlink.ToolTip>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0}/{1} in-game friends">
                                            <Binding Path="ContactList.Gaming.Count" />
                                            <Binding Path="ContactList.UserInfo.Friends.Count" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Hyperlink.ToolTip>
                            <Hyperlink.Style>
                                <Style TargetType="Hyperlink">
                                    <Setter Property="Foreground" Value="{StaticResource SixLightGray}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ContactFilter.ShowOnlyIngame}" Value="True">
                                            <Setter Property="Foreground" Value="{DynamicResource AccentColorBrush}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Hyperlink.Style>
                            IN-GAME
                        </Hyperlink>
                        |
                        <TextBlock Text="{Binding ContactList.UserInfo.OnlineFriends.Count, FallbackValue=0}"
                                   Foreground="{DynamicResource AccentColorBrush}" Margin="4,0,4,0">
                            <TextBlock.ToolTip>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0}/{1} online friends">
                                            <Binding Path="ContactList.UserInfo.OnlineFriends.Count" />
                                            <Binding Path="ContactList.UserInfo.Friends.Count" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </TextBlock.ToolTip>
                        </TextBlock>
                        <Hyperlink Command="{Binding SwitchShowOnlyOnline}"
                                   Background="Transparent" TextDecorations="None">
                            <Hyperlink.ToolTip>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0}/{1} online friends">
                                            <Binding Path="ContactList.UserInfo.OnlineFriends.Count" />
                                            <Binding Path="ContactList.UserInfo.Friends.Count" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Hyperlink.ToolTip>
                            <Hyperlink.Style>
                                <Style TargetType="Hyperlink">
                                    <Setter Property="Foreground" Value="{StaticResource SixLightGray}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ContactFilter.ShowOnlyOnline}" Value="True">
                                            <Setter Property="Foreground" Value="{DynamicResource AccentColorBrush}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Hyperlink.Style>
                            ONLINE
                        </Hyperlink>
                    </TextBlock>
                </DockPanel>
            </DockPanel>
        </Grid>

        <Grid Grid.Row="2">

            <DockPanel Margin="4 0 0 0">
                <Border BorderThickness="0 0 0 2" BorderBrush="{StaticResource SixGray}">
                    <controls1:FilterBarControl VerticalAlignment="Stretch" Width="162"
                                                ToolTip="Searches the following fields: Name"
                                                WaterMark="Search contacts..."
                                                FilterText="{Binding ContactFilter.Name, UpdateSourceTrigger=PropertyChanged}" />
                </Border>

                <Border BorderThickness="0 0 0 2" BorderBrush="{DynamicResource AccentColorBrush}" Margin="4 0 0 0">
                    <Button Name="ContactsButton"
                            Command="{Binding ContactsMenuCommand}" Width="28"
                            Background="{DynamicResource WhiteBrush}"
                            ToolTip="Friends and groups" Style="{StaticResource ImageButtonStyle}"
                            Foreground="{DynamicResource AccentColorBrush}"
                            IsHitTestVisible="{Binding ElementName=ContactsPopup, Path=IsOpen, Mode=OneWay, Converter={StaticResource InverseBooleanConverter}}">
                        <controls:IconControlInheritForeground Icon="{StaticResource Icon_Add}"
                                                               Height="{Binding ActualHeight, RelativeSource={RelativeSource FindAncestor, AncestorType=Button}, Converter={StaticResource PercentageConverter}, ConverterParameter=0.5}" />
                    </Button>
                </Border>

                <controls:NonTopmostPopup Name="ContactsPopup" PlacementTarget="{Binding ElementName=ContactsButton}"
                                          PlacementRectangle="-87,30,115,0"
                                          IsOpen="{Binding ShowContactsMenu}" Width="115"
                                          Style="{StaticResource PopupMenuStyle}">
                    <controls:PopupControl Header="Add contact">
                        <StackPanel Background="Transparent">
                            <Button Name="FindFriendButton" Command="{Binding FindFriendCommand}"
                                    Width="Auto" Height="32" Style="{StaticResource MetroTextButtonStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Style="{StaticResource TextBlockIconStyle}"
                                               Foreground="{DynamicResource AccentColorBrush}"
                                               Text="{x:Static core:SixIconFont.withSIX_icon_User_Add}" FontSize="16"
                                               Margin="-10,0,0,0" />
                                    <TextBlock Text="Find friend" Margin="10,1,0,0" />
                                </StackPanel>
                            </Button>

                            <Border BorderThickness="0,2,0,0">
                                <Border.Style>
                                    <Style TargetType="{x:Type Border}">
                                        <Setter Property="BorderBrush" Value="{StaticResource SixSoftGray}" />
                                        <Style.Triggers>
                                            <DataTrigger
                                                Binding="{Binding ElementName=FindFriendButton, Path=IsMouseOver}"
                                                Value="True">
                                                <Setter Property="BorderBrush"
                                                        Value="{DynamicResource AccentColorBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>

                            <!-- Temporarily hidden as not supported in API yet
                            <Button Name="FindGroupButton" Command="{Binding FindGroupCommand}"
                                    Width="Auto" Height="32" Style="{StaticResource MetroTextButtonStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Style="{StaticResource TextBlockIconStyle}"
                                               Foreground="{DynamicResource AccentColorBrush}"
                                               Text="{x:Static wpf:SixIconFont.withSIX_icon_Users_Group_Add}" FontSize="16" Margin="-10,0,0,0" />
                                    <TextBlock Text="Find group" Margin="10,1,0,0" />
                                </StackPanel>
                            </Button>
                            -->

                            <!-- Temporarily hidden as not supported in API yet 
                            <Border BorderThickness="0,2,0,0">
                                <Border.Style>
                                    <Style TargetType="{x:Type Border}">
                                        <Setter Property="BorderBrush" Value="{StaticResource SixSoftGray}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ElementName=FindGroupButton, Path=IsMouseOver}" Value="True">
                                                <Setter Property="BorderBrush" Value="{DynamicResource AccentColorBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                            -->

                            <Button Name="NewGroupButton" Command="{Binding NewGroupCommand}"
                                    Width="Auto" Height="32" Style="{StaticResource MetroTextButtonStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Style="{StaticResource TextBlockIconStyle}"
                                               Foreground="{StaticResource SixGreen}"
                                               Text="{x:Static core:SixIconFont.withSIX_icon_Users_Group_Add}"
                                               FontSize="16" Margin="-2,0,0,0" />
                                    <TextBlock Text="New group..." Margin="10,1,0,0" />
                                </StackPanel>
                            </Button>

                            <Border BorderThickness="0,2,0,0">
                                <Border.Style>
                                    <Style TargetType="{x:Type Border}">
                                        <Setter Property="BorderBrush" Value="{StaticResource SixSoftGray}" />
                                        <Style.Triggers>
                                            <DataTrigger
                                                Binding="{Binding ElementName=NewGroupButton, Path=IsMouseOver}"
                                                Value="True">
                                                <Setter Property="BorderBrush"
                                                        Value="{DynamicResource AccentColorBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>

                        </StackPanel>
                    </controls:PopupControl>
                </controls:NonTopmostPopup>
            </DockPanel>
        </Grid>

        <Grid Grid.Row="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="250*" />
            </Grid.RowDefinitions>
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Grid.Row="1" Width="160">
                <DockPanel
                    Visibility="{Binding ContactList.UserInfo.Friends.Count, Converter={StaticResource NonZeroToVisibilityCollapsedConverter}, ConverterParameter=True}">

                    <controls:IconControl Icon="{StaticResource Icon_User_Add}" DockPanel.Dock="Top"
                                          Margin="0 0 0 8">
                        <controls:IconControl.Resources>
                            <Style TargetType="{x:Type Path}">
                                <Setter Property="Fill" Value="Transparent" />
                                <Setter Property="Stroke" Value="{StaticResource SixLightGray}" />
                                <Setter Property="StrokeThickness" Value="72" />
                            </Style>
                        </controls:IconControl.Resources>
                    </controls:IconControl>
                    <TextBlock Text="Add friends" HorizontalAlignment="Center"
                               Foreground="{StaticResource SixLightGray}" FontSize="24"
                               TextWrapping="Wrap" TextAlignment="Center" />
                </DockPanel>
            </Grid>
            <StackPanel Grid.Row="0"
                        Visibility="{Binding ContactList.Invites.Count, FallbackValue=Collapsed, Converter={StaticResource NonZeroToVisibilityCollapsedConverter}}">
                <Button
                    Command="{Binding ResetHiddenInviteRequests}"
                    Height="22" Margin="0,0,0,4" Style="{StaticResource ImageButtonStyle}"
                    Foreground="{DynamicResource AccentColorBrush}">
                    <DockPanel>
                        <controls:IconControlInheritForeground Icon="{StaticResource Icon_User_Add}"
                                                               Height="{Binding ActualHeight, RelativeSource={RelativeSource FindAncestor, AncestorType=Button}, Converter={StaticResource PercentageConverter}, ConverterParameter=0.5}" />
                        <TextBlock Margin="4 0 0 0" VerticalAlignment="Center"
                                   Text="{Binding ContactList.Invites.Count, StringFormat={}{0} BUDDY REQUESTS}" />
                    </DockPanel>
                </Button>
            </StackPanel>
            <ListBox Name="Contacts" Grid.Row="1" SelectedItem="{Binding SelectedContact}"
                     BorderBrush="Transparent" VerticalAlignment="Stretch" BorderThickness="0"
                     Background="Transparent"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     ScrollViewer.VerticalScrollBarVisibility="Visible"
                     ItemsSource="{Binding Source={StaticResource Contacts}}"
                     cal:Message.Attach="[Event MouseDoubleClick] = [Action DoubleClicked($eventArgs)]"
                     VirtualizingStackPanel.VirtualizationMode="Standard"
                     dragDrop:DragDrop.IsDragSource="True"
                     dragDrop:DragDrop.IsDropTarget="True"
                     dragDrop:DragDrop.DropHandler="{Binding}">
                <ListBox.Resources>

                    <ContextMenu x:Key="GroupMenu"
                                 DataContext="{Binding PlacementTarget.Tag.GroupContextMenu, RelativeSource={RelativeSource Self}}" />

                    <ContextMenu x:Key="GroupMemberMenu"
                                 DataContext="{Binding PlacementTarget.Tag.GroupMemberContextMenu, RelativeSource={RelativeSource Self}}" />

                    <ContextMenu x:Key="InviteRequestMenu"
                                 DataContext="{Binding PlacementTarget.Tag.InviteRequestContextMenu, RelativeSource={RelativeSource Self}}" />

                    <DataTemplate DataType="{x:Type viewModels11:UserContactDataModel}">
                        <Border BorderThickness="4 0 0 0"
                                BorderBrush="{Binding Friend.Status, Converter={StaticResource OnlineStatusToForegroundConverter}}">
                            <Grid Background="Transparent"
                                  Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox}}"
                                  ContextMenu="{StaticResource UserContactMenu}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="40" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40" />
                                    <ColumnDefinition Width="140*" />
                                    <ColumnDefinition Width="28" />
                                    <ColumnDefinition Width="20" />
                                </Grid.ColumnDefinitions>

                                <controls:CachedImageWithAnimatedGifSupport
                                    ImageUrl="{Binding Friend.Account.Avatar}"
                                    DefaultImageSource="pack://application:,,,/SN.withSIX.Core.Presentation.Resources;component/images/ProfilePlaceholder-small40x40.png"
                                    Grid.Column="0" Grid.Row="0" MaxHeight="32" MaxWidth="32" />

                                <DockPanel Grid.Row="0" Grid.Column="1" Margin="4 0 0 0"
                                           VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Friend.Account.DisplayName}"
                                               FontSize="14" Height="20" DockPanel.Dock="Top" />
                                    <DockPanel DockPanel.Dock="Top">
                                        <Viewbox
                                            ToolTip="{Binding Friend.PlayingOn}"
                                            MaxWidth="12" MaxHeight="12"
                                            Visibility="{Binding Friend.Server, Converter={StaticResource NotNullToVisibilityConverter},FallbackValue=Collapsed}">
                                            <Canvas Width="12.249" Height="14.000">
                                                <!-- Ebene 1/<Compound Path> -->
                                                <Path Fill="{StaticResource SixGreen}"
                                                      Data="F1 M 10.861,8.795 C 10.861,9.100 10.388,9.346 9.802,9.346 C 9.216,9.346 8.744,9.100 8.744,8.795 L 8.744,8.448 C 8.744,8.146 9.238,7.931 9.802,7.931 C 10.367,7.931 10.834,8.146 10.861,8.448 L 10.861,8.795 Z M 12.242,8.728 C 12.242,8.587 12.160,8.446 11.978,8.341 L 7.392,5.684 L 7.392,0.747 C 7.392,0.334 6.812,0.000 6.125,0.000 C 5.438,0.000 4.858,0.334 4.858,0.747 L 4.858,6.756 C 4.858,6.816 4.819,6.850 4.790,6.867 C 4.779,6.872 4.769,6.877 4.759,6.881 C 4.758,6.881 4.757,6.881 4.757,6.881 L 4.757,6.881 C 4.493,7.004 4.361,7.160 4.361,7.328 L 4.361,7.568 C 4.361,7.665 4.261,7.693 4.261,7.693 L 4.261,7.693 C 3.871,7.816 3.728,7.971 3.728,8.141 L 3.728,9.017 C 3.728,9.341 3.535,9.164 3.535,9.164 C 3.446,9.071 3.397,8.980 3.397,8.900 L 3.397,7.818 C 3.397,7.650 3.539,7.496 3.955,7.373 L 3.955,7.373 C 3.955,7.373 4.059,7.342 4.059,7.246 L 4.059,7.008 C 4.059,6.840 4.170,6.684 4.431,6.561 L 4.430,6.561 C 4.430,6.561 4.521,6.523 4.529,6.443 L 4.529,5.903 L 0.308,8.341 C 0.127,8.445 0.021,8.586 0.021,8.724 C 0.021,8.723 0.013,8.722 0.013,8.722 C 0.010,9.944 0.004,9.236 0.000,10.460 C 0.000,10.479 0.005,10.495 0.008,10.514 C 0.008,10.520 0.008,10.521 0.009,10.527 C 0.013,10.550 0.021,10.574 0.032,10.594 C 0.036,10.613 0.047,10.630 0.056,10.646 C 0.063,10.659 0.072,10.671 0.079,10.683 C 0.099,10.707 0.119,10.731 0.146,10.755 C 0.152,10.761 0.159,10.766 0.166,10.771 C 0.198,10.797 0.230,10.821 0.271,10.846 C 0.272,10.846 0.273,10.846 0.273,10.848 L 5.460,13.843 C 5.563,13.902 5.685,13.943 5.814,13.968 C 6.145,14.036 6.524,13.995 6.787,13.843 L 11.958,10.848 C 12.141,10.741 12.249,10.603 12.249,10.465 C 12.250,9.242 12.239,9.946 12.242,8.728 Z" />
                                            </Canvas>
                                        </Viewbox>
                                        <TextBlock Margin="4 0 0 0"
                                                   Text="{Binding Friend.Server.Name}"
                                                   ToolTip="{Binding Friend.PlayingOn}"
                                                   TextTrimming="CharacterEllipsis" FontSize="10"
                                                   extensions:TextBlockTrimmedTooltip.AutomaticToolTipEnabled="True"
                                                   Visibility="{Binding Friend.Server, Converter={StaticResource NotNullToVisibilityConverter},FallbackValue=Collapsed}" />
                                    </DockPanel>
                                </DockPanel>

                                <Button Grid.Column="2" Grid.Row="0"

                                        HorizontalAlignment="Center"
                                        Background="Transparent" ToolTip="Open chat"
                                        Command="{Binding DataContext.OChat, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                        CommandParameter="{Binding}">
                                    <Button.Template>
                                        <ControlTemplate>
                                            <Border Background="{TemplateBinding Background}"
                                                    IsHitTestVisible="True">
                                                <Grid>
                                                    <Viewbox MaxWidth="24" MaxHeight="24" x:Name="vb">
                                                        <Canvas Width="14.000" Height="13.999">
                                                            <!-- Ebene 1/<Path> -->
                                                            <Path x:Name="icon"
                                                                  Fill="{StaticResource SixOrange}"
                                                                  Data="F1 M 12.189,0.000 L 1.811,0.000 C 0.814,0.000 0.000,0.850 0.000,1.893 L 0.000,9.719 C 0.000,10.763 0.814,11.617 1.811,11.617 L 4.384,11.617 C 4.384,12.355 4.384,13.105 4.384,13.844 C 4.384,13.973 4.548,14.055 4.642,13.954 L 7.617,11.617 L 12.189,11.617 C 13.186,11.617 14.000,10.763 14.000,9.719 L 14.000,1.893 C 14.000,0.850 13.186,0.000 12.189,0.000 Z" />
                                                        </Canvas>
                                                    </Viewbox>
                                                    <TextBlock
                                                        Text="{Binding Friend.UnreadPrivateMessages}"
                                                        Margin="0 -4 0 0" Foreground="{DynamicResource WhiteBrush}"
                                                        HorizontalAlignment="Center"
                                                        Visibility="{Binding Friend.UnreadPrivateMessages, Converter={StaticResource NonZeroToVisibilityCollapsedConverter}}"
                                                        VerticalAlignment="Center" />
                                                </Grid>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger
                                                    Binding="{Binding Friend.UnreadPrivateMessages}"
                                                    Value="0">
                                                    <Setter Property="MaxWidth" Value="16"
                                                            TargetName="vb" />
                                                    <Setter Property="MaxHeight" Value="16"
                                                            TargetName="vb" />
                                                    <Setter Property="Fill"
                                                            Value="{StaticResource SixSoftGray}"
                                                            TargetName="icon" />
                                                </DataTrigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type viewModels11:GroupContactDataModel}">
                        <Grid Background="Transparent"
                              Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox}}"
                              ContextMenu="{StaticResource GroupMenu}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Border BorderThickness="4 0 0 0" BorderBrush="{DynamicResource AccentColorBrush}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="40" />
                                        <ColumnDefinition Width="140*" />
                                        <ColumnDefinition Width="28" />
                                        <ColumnDefinition Width="20" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Style="{StaticResource TextBlockIconStyle}"
                                               Foreground="{StaticResource SixLightGray}"
                                               Text="{x:Static core:SixIconFont.withSIX_icon_Social_Group}"
                                               FontSize="32"
                                               Grid.Column="0" Grid.Row="0" Width="32" Height="32"
                                               Visibility="{Binding Group.Avatar, Converter={StaticResource NotNullToVisibilityConverter}, ConverterParameter=True}" />
                                    <controls:CachedImageWithAnimatedGifSupport
                                        ImageUrl="{Binding Group.Avatar}"
                                        Grid.Column="0" Grid.Row="0" MaxHeight="32"
                                        MaxWidth="32"
                                        Visibility="{Binding Group.Avatar, Converter={StaticResource NotNullToVisibilityConverter}}" />

                                    <DockPanel Grid.Row="0" Grid.Column="1" Margin="4 0 0 0"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Center">

                                        <TextBlock Text="{Binding Model.DisplayName}"
                                                   DockPanel.Dock="Top"
                                                   FontSize="14" Height="20" />
                                        <DockPanel>
                                            <controls:IconControl Icon="{StaticResource Icon_Users_Group}"
                                                                  MaxHeight="14" MaxWidth="14">
                                                <controls:IconControl.Resources>
                                                    <Style TargetType="{x:Type Path}">
                                                        <Setter Property="Fill"
                                                                Value="{DynamicResource AccentColorBrush}" />
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                                Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBoxItem}}"
                                                                Value="True">
                                                                <Setter Property="Fill"
                                                                        Value="White" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </controls:IconControl.Resources>
                                            </controls:IconControl>

                                            <TextBlock Text="{x:Static core:SixIconFont.withSIX_icon_Upload}"
                                                       Style="{StaticResource TextBlockIconStyle}"
                                                       ToolTip="Uploading images, please wait"
                                                       Visibility="{Binding Group.IsUploading, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" />

                                            <TextBlock
                                                Visibility="{Binding Group.UploadMessage, Converter={StaticResource NotNullOrEmptyToVisibilityConverter}}"
                                                ToolTip="{Binding Group.UploadMessage}"
                                                Foreground="{StaticResource SixSoftRed}"
                                                Style="{StaticResource TextBlockIconStyle}"
                                                Text="{x:Static core:SixIconFont.withSIX_icon_Alert}" />

                                            <TextBlock
                                                Text="{Binding Group.Members.Count, StringFormat={}{0} members}"
                                                Margin="4 0 0 0" />
                                        </DockPanel>
                                    </DockPanel>

                                    <Button Grid.Column="2" Grid.Row="0"

                                            HorizontalAlignment="Center"
                                            Background="Transparent" ToolTip="Open chat"
                                            Command="{Binding DataContext.OChat, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                            CommandParameter="{Binding}">
                                        <Button.Template>
                                            <ControlTemplate>
                                                <Border Background="{TemplateBinding Background}"
                                                        IsHitTestVisible="True">
                                                    <Grid>
                                                        <Viewbox MaxWidth="24" MaxHeight="24" x:Name="vb">
                                                            <Canvas Width="14.000" Height="13.999">
                                                                <!-- Ebene 1/<Path> -->
                                                                <Path x:Name="icon"
                                                                      Fill="{StaticResource SixOrange}"
                                                                      Data="F1 M 12.189,0.000 L 1.811,0.000 C 0.814,0.000 0.000,0.850 0.000,1.893 L 0.000,9.719 C 0.000,10.763 0.814,11.617 1.811,11.617 L 4.384,11.617 C 4.384,12.355 4.384,13.105 4.384,13.844 C 4.384,13.973 4.548,14.055 4.642,13.954 L 7.617,11.617 L 12.189,11.617 C 13.186,11.617 14.000,10.763 14.000,9.719 L 14.000,1.893 C 14.000,0.850 13.186,0.000 12.189,0.000 Z" />
                                                            </Canvas>
                                                        </Viewbox>
                                                        <TextBlock
                                                            Text="{Binding Group.Chat.UnreadCount}"
                                                            Margin="0 -4 0 0" Foreground="{DynamicResource WhiteBrush}"
                                                            HorizontalAlignment="Center"
                                                            Visibility="{Binding Group.Chat.UnreadCount, Converter={StaticResource NonZeroToVisibilityCollapsedConverter}}"
                                                            VerticalAlignment="Center" />
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding Group.Chat.UnreadCount, FallbackValue=0}"
                                                        Value="0">
                                                        <Setter Property="MaxWidth" Value="16"
                                                                TargetName="vb" />
                                                        <Setter Property="MaxHeight" Value="16"
                                                                TargetName="vb" />
                                                        <Setter Property="Fill"
                                                                Value="{StaticResource SixSoftGray}"
                                                                TargetName="icon" />
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>

                                    <ToggleButton Name="ShowGroupMembersToggle" Grid.Column="3"
                                                  Grid.Row="0" HorizontalAlignment="Center"

                                                  Background="Transparent">
                                        <ToggleButton.Template>
                                            <ControlTemplate>
                                                <Border Background="{TemplateBinding Background}"
                                                        IsHitTestVisible="True">
                                                    <Viewbox MaxWidth="16" MaxHeight="16" x:Name="vb">
                                                        <Canvas Width="14.000" Height="13.999">

                                                            <Path Stroke="{DynamicResource TextBrush}"
                                                                  StrokeThickness="3" Width="12"
                                                                  Height="12">
                                                                <Path.Style>
                                                                    <Style TargetType="{x:Type Path}">
                                                                        <Style.Triggers>
                                                                            <DataTrigger
                                                                                Binding="{Binding Path=IsChecked, ElementName=ShowGroupMembersToggle}"
                                                                                Value="True">
                                                                                <Setter Property="Data"
                                                                                        Value="M0,6 H12" />
                                                                            </DataTrigger>
                                                                            <DataTrigger
                                                                                Binding="{Binding Path=IsChecked, ElementName=ShowGroupMembersToggle}"
                                                                                Value="False">
                                                                                <Setter Property="Data"
                                                                                        Value="M0,6 H12 M6,6 V12Z" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Path.Style>
                                                            </Path>

                                                        </Canvas>
                                                    </Viewbox>
                                                </Border>
                                            </ControlTemplate>
                                        </ToggleButton.Template>

                                        <ToggleButton.Style>
                                            <Style TargetType="{x:Type ToggleButton}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding Path=IsChecked, ElementName=ShowGroupMembersToggle}"
                                                        Value="True">
                                                        <Setter Property="ToolTip" Value="Hide members" />
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding Path=IsChecked, ElementName=ShowGroupMembersToggle}"
                                                        Value="False">
                                                        <Setter Property="ToolTip" Value="Show members" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>
                                </Grid>
                            </Border>
                            <Border Grid.Row="1" Grid.ColumnSpan="4" BorderThickness="0 2 0 0"
                                    BorderBrush="{StaticResource SixSoftGray}">
                                <ListBox Margin="8 0 0 0"
                                         Visibility="{Binding Path=IsChecked, ElementName=ShowGroupMembersToggle, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                         Height="Auto" ItemsSource="{Binding MembersView}"
                                         SelectedItem="{Binding SelectedMember}"
                                         Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox}}">
                                    <ListBox.Resources>
                                        <DataTemplate DataType="{x:Type viewModels11:GroupMemberContactDataModel}">
                                            <Border BorderThickness="4 0 0 0"
                                                    BorderBrush="{Binding Friend.Status, Converter={StaticResource OnlineStatusToForegroundConverter}}">
                                                <Grid Background="Transparent"
                                                      Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox, AncestorLevel=2}}"
                                                      ContextMenu="{StaticResource GroupMemberMenu}">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="40" />
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="40" />
                                                        <ColumnDefinition Width="140*" />
                                                        <ColumnDefinition Width="28" />
                                                        <ColumnDefinition Width="20" />
                                                    </Grid.ColumnDefinitions>

                                                    <controls:CachedImageWithAnimatedGifSupport
                                                        ImageUrl="{Binding Friend.Account.Avatar}"
                                                        DefaultImageSource="pack://application:,,,/SN.withSIX.Core.Presentation.Resources;component/images/ProfilePlaceholder-small40x40.png"
                                                        Grid.Column="0" Grid.Row="0" MaxHeight="32"
                                                        MaxWidth="32" />

                                                    <DockPanel Grid.Row="0" Grid.Column="1" Margin="4,0,0,0"
                                                               HorizontalAlignment="Left"
                                                               VerticalAlignment="Center">

                                                        <TextBlock Text="{Binding Friend.Account.DisplayName}"
                                                                   DockPanel.Dock="Top"
                                                                   FontSize="14" Height="20"
                                                                   ToolTip="{Binding Friend, StringFormat={}Last seen {0}}">
                                                            <TextBlock.Style>
                                                                <Style TargetType="{x:Type TextBlock}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsMe}"
                                                                                     Value="True">
                                                                            <Setter Property="Foreground"
                                                                                    Value="{StaticResource SixLightGray}" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding IsOwner}"
                                                                                     Value="True">
                                                                            <Setter Property="Foreground"
                                                                                    Value="{StaticResource SixOrange}" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        <Grid>
                                                            <DockPanel>
                                                                <Viewbox
                                                                    ToolTip="{Binding Friend.PlayingOn}"
                                                                    MaxWidth="12" MaxHeight="12"
                                                                    Visibility="{Binding Friend.Server, Converter={StaticResource NotNullToVisibilityConverter},FallbackValue=Collapsed}">
                                                                    <Canvas Width="12.249" Height="14.000">
                                                                        <!-- Ebene 1/<Compound Path> -->
                                                                        <Path Fill="{StaticResource SixGreen}"
                                                                              Data="F1 M 10.861,8.795 C 10.861,9.100 10.388,9.346 9.802,9.346 C 9.216,9.346 8.744,9.100 8.744,8.795 L 8.744,8.448 C 8.744,8.146 9.238,7.931 9.802,7.931 C 10.367,7.931 10.834,8.146 10.861,8.448 L 10.861,8.795 Z M 12.242,8.728 C 12.242,8.587 12.160,8.446 11.978,8.341 L 7.392,5.684 L 7.392,0.747 C 7.392,0.334 6.812,0.000 6.125,0.000 C 5.438,0.000 4.858,0.334 4.858,0.747 L 4.858,6.756 C 4.858,6.816 4.819,6.850 4.790,6.867 C 4.779,6.872 4.769,6.877 4.759,6.881 C 4.758,6.881 4.757,6.881 4.757,6.881 L 4.757,6.881 C 4.493,7.004 4.361,7.160 4.361,7.328 L 4.361,7.568 C 4.361,7.665 4.261,7.693 4.261,7.693 L 4.261,7.693 C 3.871,7.816 3.728,7.971 3.728,8.141 L 3.728,9.017 C 3.728,9.341 3.535,9.164 3.535,9.164 C 3.446,9.071 3.397,8.980 3.397,8.900 L 3.397,7.818 C 3.397,7.650 3.539,7.496 3.955,7.373 L 3.955,7.373 C 3.955,7.373 4.059,7.342 4.059,7.246 L 4.059,7.008 C 4.059,6.840 4.170,6.684 4.431,6.561 L 4.430,6.561 C 4.430,6.561 4.521,6.523 4.529,6.443 L 4.529,5.903 L 0.308,8.341 C 0.127,8.445 0.021,8.586 0.021,8.724 C 0.021,8.723 0.013,8.722 0.013,8.722 C 0.010,9.944 0.004,9.236 0.000,10.460 C 0.000,10.479 0.005,10.495 0.008,10.514 C 0.008,10.520 0.008,10.521 0.009,10.527 C 0.013,10.550 0.021,10.574 0.032,10.594 C 0.036,10.613 0.047,10.630 0.056,10.646 C 0.063,10.659 0.072,10.671 0.079,10.683 C 0.099,10.707 0.119,10.731 0.146,10.755 C 0.152,10.761 0.159,10.766 0.166,10.771 C 0.198,10.797 0.230,10.821 0.271,10.846 C 0.272,10.846 0.273,10.846 0.273,10.848 L 5.460,13.843 C 5.563,13.902 5.685,13.943 5.814,13.968 C 6.145,14.036 6.524,13.995 6.787,13.843 L 11.958,10.848 C 12.141,10.741 12.249,10.603 12.249,10.465 C 12.250,9.242 12.239,9.946 12.242,8.728 Z" />
                                                                    </Canvas>
                                                                </Viewbox>
                                                                <TextBlock Margin="4 0 0 0"
                                                                           Text="{Binding Friend.Server.Name}"
                                                                           ToolTip="{Binding Friend.PlayingOn}"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           FontSize="10"
                                                                           extensions:TextBlockTrimmedTooltip.AutomaticToolTipEnabled="True"
                                                                           Visibility="{Binding Friend.Server, Converter={StaticResource NotNullToVisibilityConverter},FallbackValue=Collapsed}" />
                                                            </DockPanel>
                                                        </Grid>
                                                    </DockPanel>

                                                    <Button Grid.Column="2" Grid.Row="0" HorizontalAlignment="Center"

                                                            Background="Transparent" ToolTip="Open chat"
                                                            Command="{Binding DataContext.OChat, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}, AncestorLevel=2}}"
                                                            CommandParameter="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate>
                                                                <Border Background="{TemplateBinding Background}"
                                                                        IsHitTestVisible="True">
                                                                    <Viewbox MaxWidth="16" MaxHeight="16" x:Name="vb">
                                                                        <Canvas Width="14.000" Height="13.999">
                                                                            <!-- Ebene 1/<Path> -->
                                                                            <Path Fill="{StaticResource SixSoftGray}"
                                                                                  Data="F1 M 12.189,0.000 L 1.811,0.000 C 0.814,0.000 0.000,0.850 0.000,1.893 L 0.000,9.719 C 0.000,10.763 0.814,11.617 1.811,11.617 L 4.384,11.617 C 4.384,12.355 4.384,13.105 4.384,13.844 C 4.384,13.973 4.548,14.055 4.642,13.954 L 7.617,11.617 L 12.189,11.617 C 13.186,11.617 14.000,10.763 14.000,9.719 L 14.000,1.893 C 14.000,0.850 13.186,0.000 12.189,0.000 Z" />
                                                                        </Canvas>
                                                                    </Viewbox>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.Resources>
                                    <ListBox.Template>
                                        <ControlTemplate>
                                            <ItemsPresenter />
                                        </ControlTemplate>
                                    </ListBox.Template>
                                </ListBox>
                            </Border>
                        </Grid>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type viewModels11:ChatContactDataModel}">
                        <Grid Background="Transparent"
                              Tag="{Binding DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Border BorderThickness="4 0 0 0" BorderBrush="{StaticResource SixGray}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="40" />
                                        <ColumnDefinition Width="140*" />
                                        <ColumnDefinition Width="28" />
                                        <ColumnDefinition Width="20" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Style="{StaticResource TextBlockIconStyle}"
                                               Foreground="{StaticResource SixLightGray}"
                                               Text="{x:Static core:SixIconFont.withSIX_icon_Chat_Message}"
                                               FontSize="32"
                                               Grid.Column="0" Grid.Row="0" Width="32" Height="32" />

                                    <DockPanel Grid.Row="0" Grid.Column="1" Margin="4 0 0 0"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Model.DisplayName}"
                                                   DockPanel.Dock="Top"
                                                   FontSize="14" Height="20" />
                                    </DockPanel>

                                    <Button Grid.Column="2" Grid.Row="0"

                                            HorizontalAlignment="Center"
                                            Background="Transparent" ToolTip="Open chat"
                                            Command="{Binding DataContext.OChat, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                            CommandParameter="{Binding}">
                                        <Button.Template>
                                            <ControlTemplate>
                                                <Border Background="{TemplateBinding Background}"
                                                        IsHitTestVisible="True">
                                                    <Grid>
                                                        <Viewbox MaxWidth="24" MaxHeight="24" x:Name="vb">
                                                            <Canvas Width="14.000" Height="13.999">
                                                                <!-- Ebene 1/<Path> -->
                                                                <Path x:Name="icon"
                                                                      Fill="{StaticResource SixOrange}"
                                                                      Data="F1 M 12.189,0.000 L 1.811,0.000 C 0.814,0.000 0.000,0.850 0.000,1.893 L 0.000,9.719 C 0.000,10.763 0.814,11.617 1.811,11.617 L 4.384,11.617 C 4.384,12.355 4.384,13.105 4.384,13.844 C 4.384,13.973 4.548,14.055 4.642,13.954 L 7.617,11.617 L 12.189,11.617 C 13.186,11.617 14.000,10.763 14.000,9.719 L 14.000,1.893 C 14.000,0.850 13.186,0.000 12.189,0.000 Z" />
                                                            </Canvas>
                                                        </Viewbox>
                                                        <TextBlock
                                                            Text="{Binding Chat.UnreadCount}"
                                                            Margin="0 -4 0 0" Foreground="{DynamicResource WhiteBrush}"
                                                            HorizontalAlignment="Center"
                                                            Visibility="{Binding Chat.UnreadCount, Converter={StaticResource NonZeroToVisibilityCollapsedConverter}}"
                                                            VerticalAlignment="Center" />
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding Chat.UnreadCount, FallbackValue=0}"
                                                        Value="0">
                                                        <Setter Property="MaxWidth" Value="16"
                                                                TargetName="vb" />
                                                        <Setter Property="MaxHeight" Value="16"
                                                                TargetName="vb" />
                                                        <Setter Property="Fill"
                                                                Value="{StaticResource SixSoftGray}"
                                                                TargetName="icon" />
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </Grid>
                            </Border>
                        </Grid>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type viewModels11:InviteRequestContactDataModel}">
                        <Border BorderThickness="4 0 0 0"
                                BorderBrush="{StaticResource SixSoftGray}">
                            <Grid Background="{StaticResource SixLightGray}">
                                <Grid
                                    Visibility="{Binding Model.IsMine, Converter={StaticResource BooleanToVisibilityCollapsedConverter}, FallbackValue=Collapsed}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="40" />
                                        <ColumnDefinition Width="170*" />
                                        <ColumnDefinition Width="24" />
                                    </Grid.ColumnDefinitions>

                                    <controls:CachedImageWithAnimatedGifSupport
                                        ImageUrl="{Binding Model.Target.Avatar}"
                                        DefaultImageSource="pack://application:,,,/SN.withSIX.Core.Presentation.Resources;component/images/ProfilePlaceholder-small40x40.png"
                                        MaxHeight="32" MaxWidth="32" Grid.Column="0" />

                                    <DockPanel Grid.Column="1" VerticalAlignment="Center" Margin="4 0 0 0">
                                        <TextBlock DockPanel.Dock="Top">
                                            <TextBlock Text="{Binding Model.DisplayName}" FontSize="14" />
                                            <TextBlock FontSize="10">
                                                <Hyperlink
                                                    Command="{Binding DataContext.VisitProfileCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                                    CommandParameter="{Binding}">
                                                    (profile)
                                                </Hyperlink>
                                            </TextBlock>
                                        </TextBlock>

                                        <TextBlock Text="Request Pending..." FontSize="10" />
                                    </DockPanel>
                                    <Button Content="x" VerticalContentAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            Foreground="{DynamicResource WhiteBrush}"
                                            VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.HideCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                            Grid.Column="2" FontSize="16"
                                            ToolTip="Hide request"
                                            CommandParameter="{Binding}" />
                                </Grid>
                                <Grid ContextMenu="{StaticResource InviteRequestMenu}"
                                      Visibility="{Binding Model.IsMine, Converter={StaticResource BooleanToVisibilityCollapsedConverter},ConverterParameter=True, FallbackValue=Collapsed}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="40" />
                                        <ColumnDefinition Width="170*" />
                                        <ColumnDefinition Width="48" />
                                        <ColumnDefinition Width="24" />
                                    </Grid.ColumnDefinitions>

                                    <controls:CachedImageWithAnimatedGifSupport
                                        ImageUrl="{Binding Model.Account.Avatar}"
                                        DefaultImageSource="pack://application:,,,/SN.withSIX.Core.Presentation.Resources;component/images/ProfilePlaceholder-small40x40.png"
                                        MaxHeight="32" MaxWidth="32" Grid.Column="0" />

                                    <Grid Grid.Column="1">
                                        <DockPanel VerticalAlignment="Center" Margin="4 0 0 0">
                                            <TextBlock Text="{Binding Model.DisplayName}" FontSize="14"
                                                       DockPanel.Dock="Top" />

                                            <TextBlock HorizontalAlignment="Left" DockPanel.Dock="Top"
                                                       FontSize="10">
                                                <Hyperlink
                                                    Command="{Binding DataContext.VisitProfileCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                                    CommandParameter="{Binding}">
                                                    (profile)
                                                </Hyperlink>
                                            </TextBlock>
                                        </DockPanel>
                                    </Grid>
                                    <DockPanel Grid.Column="2" VerticalAlignment="Center">
                                        <DockPanel.Resources>
                                            <Style TargetType="{x:Type Button}"
                                                   BasedOn="{StaticResource MetroTextButtonStyle}">
                                                <Setter Property="Width" Value="48" />
                                                <Setter Property="Height" Value="20" />
                                                <Setter Property="FontSize" Value="10" />
                                                <Setter Property="Foreground" Value="{DynamicResource WhiteBrush}" />
                                                <Setter Property="VerticalAlignment" Value="Top" />
                                                <Setter Property="BorderThickness" Value="0" />
                                            </Style>
                                        </DockPanel.Resources>
                                        <Button Content="Accept" DockPanel.Dock="Top"
                                                Command="{Binding DataContext.ApproveCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                                CommandParameter="{Binding}"
                                                Background="{StaticResource SixGreen}" />
                                        <Button Content="Decline" DockPanel.Dock="Top"
                                                Command="{Binding DataContext.DeclineCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                                CommandParameter="{Binding}"
                                                Background="{StaticResource SixSoftRed}" />
                                    </DockPanel>
                                    <Button Content="x" VerticalContentAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            Foreground="{DynamicResource WhiteBrush}"
                                            VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.HideCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBox}}}"
                                            Grid.Column="3" FontSize="16"
                                            ToolTip="Hide request"
                                            CommandParameter="{Binding}" />
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.Resources>
            </ListBox>
            <!-- VirtualizationMode="Recycling" breaks WPF Animated Gif; showing the wrong image for several contacts (try scrolling -->
        </Grid>

        <Grid Grid.Row="4" VerticalAlignment="Top" cal:Bind.Model="{Binding}" MaxHeight="400"
              Background="{StaticResource SixMediumGray}"
              Visibility="{Binding ShowFindFriend, Converter={StaticResource BooleanToVisibilityCollapsedConverter}, FallbackValue=Collapsed}">
            <Grid Margin="4">
                <Grid.Resources>
                    <Style TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Type Button}}">
                        <Setter Property="Foreground" Value="{StaticResource SixSoftGray}" />
                    </Style>
                    <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                        <Setter Property="Foreground" Value="{StaticResource SixSoftGray}" />
                    </Style>
                </Grid.Resources>
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180" />
                            <ColumnDefinition Width="20*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.ColumnSpan="2"
                                   Text="Add Friend" FontSize="14" FontWeight="Bold" Padding="4"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />

                        <Button Grid.Column="1" Command="{Binding FindFriendCommand}"
                                HorizontalAlignment="Right" VerticalAlignment="Top"
                                Style="{StaticResource MetroTextButtonStyle}">
                            <TextBlock Style="{StaticResource TextBlockIconStyle}"
                                       Foreground="{StaticResource SixSoftGray}"
                                       Text="{x:Static core:SixIconFont.withSIX_icon_X}" FontSize="10" />
                        </Button>
                    </Grid>

                    <controls1:FilterBarControl x:Name="AddFriendInput" WaterMark="Search for friend..."
                                                ToolTip="Searches the following fields: Name"
                                                Margin="4 0 4 0"
                                                FilterText="{Binding AddFriendInput,UpdateSourceTrigger=PropertyChanged}"
                                                Height="24" VerticalAlignment="Top" />

                    <TextBlock
                        Text="{Binding Items.Count, ElementName=UsersList,FallbackValue=0 found,StringFormat={}{0} found}"
                        HorizontalAlignment="Right" Height="22"
                        Visibility="{Binding ContactList.AddFriendSearching, Converter={StaticResource BooleanToVisibilityCollapsedConverter}, ConverterParameter=true}"
                        VerticalAlignment="Center" Margin="0,4,4,0" />
                    <TextBlock Text="Searching, Please wait..."
                               Visibility="{Binding ContactList.AddFriendSearching, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                               HorizontalAlignment="Right" Height="22" VerticalAlignment="Center"
                               Margin="0,3,5,0" />
                </StackPanel>

                <ListBox Name="UsersList" SelectedItem="{Binding SelectedAddFriend}" Margin="0,73,0,0"
                         BorderBrush="Transparent" VerticalAlignment="Stretch" BorderThickness="0"
                         Background="{DynamicResource WhiteBrush}"
                         ItemsSource="{Binding Source={StaticResource AddFriendViewSource}}"
                         ItemTemplate="{StaticResource AddFriendTemplate}" />
            </Grid>
        </Grid>

        <Grid Row="2" Grid.RowSpan="3">
            <ContentControl Name="FriendNotifications" HorizontalAlignment="Left" VerticalAlignment="Top" />

            <ContentControl Name="ChatNotifications" HorizontalAlignment="Left" VerticalAlignment="Top" />
        </Grid>
    </Grid>
</UserControl>